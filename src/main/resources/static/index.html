<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
</head>

<body>
    <h1>Student Management System</h1>

    <!-- Form to add a new student -->
    <h1>Add/Edit Student</h1>
    <form id="studentForm">
        <label for="regNo">Registration Number:</label><br>
        <input type="text" id="regNo" required><br>

        <label for="name">Name:</label><br>
        <input type="text" id="name" required><br>

        <label for="dob">Date of Birth:</label><br>
        <input type="date" id="dob" required><br>

        <label for="gender">Gender:</label><br>
        <input type="text" id="gender" required><br>

        <label for="address">Address:</label><br>
        <input type="text" id="address"><br>

        <label for="phoneNo">Phone Number:</label><br>
        <input type="text" id="phoneNo"><br>

        <label for="email">Email:</label><br>
        <input type="email" id="email"><br>

        <label for="guardianName">Guardian Name:</label><br>
        <input type="text" id="guardianName"><br>

        <label for="guardianPhone">Guardian Phone:</label><br>
        <input type="text" id="guardianPhone"><br>

        <label for="doj">Date of Joining:</label><br>
        <input type="date" id="doj"><br>

        <label for="branch">Branch:</label><br>
        <input type="text" id="branch"><br>

        <button type="submit">Add Student</button>
    </form>


    <!-- Container to display all students -->
    <h2>All Students</h2>
    <div id="studentList"></div>

    <!-- JavaScript to handle form submission and fetch student data -->
    <script>
        const studentForm = document.getElementById('studentForm');
        const studentListContainer = document.getElementById('studentList');

        studentForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const regNo = document.getElementById('regNo').value;
            const name = document.getElementById('name').value;
            const dob = document.getElementById('dob').value;
            const gender = document.getElementById('gender').value;
            const address = document.getElementById('address').value;
            const phoneNo = document.getElementById('phoneNo').value;
            const email = document.getElementById('email').value;
            const guardianName = document.getElementById('guardianName').value;
            const guardianPhone = document.getElementById('guardianPhone').value;
            const doj = document.getElementById('doj').value;
            const branch = document.getElementById('branch').value;

            const response = await fetch('/api/student', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    regNo,
                    name,
                    dob,
                    gender,
                    address,
                    phoneNo,
                    email,
                    guardianName,
                    guardianPhone,
                    doj,
                    branch
                })
            });

            if (response.ok) {
                alert('Student added successfully');
                fetchAllStudents();
            } else {
                alert('Failed to add student');
            }
        });

        async function fetchAllStudents() {
            const response = await fetch('/api/all');
            if (response.ok) {
                const students = await response.json();
                renderStudents(students);
            } else {
                alert('Failed to fetch students');
            }
        }

        function renderStudents(students) {
            studentListContainer.innerHTML = '';
            students.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.innerHTML = `
                    <p><strong>Registration Number:</strong> ${student.regNo}</p>
                    <p><strong>Name:</strong> ${student.name}</p>
                    <p><strong>Date of Birth:</strong> ${student.dob}</p>
                    <p><strong>Gender:</strong> ${student.gender}</p>
                    <!-- Render more fields here -->
                    <button onclick="deleteStudent('${student.regNo}')">Delete</button>
                    <button onclick="editStudent('${student.regNo}')">Edit</button>
                `;
                studentListContainer.appendChild(studentDiv);
            });
        }

        async function deleteStudent(regNo) {
            const response = await fetch(`/api/student/${regNo}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                alert('Student deleted successfully');
                fetchAllStudents();
            } else {
                alert('Failed to delete student');
            }
        }

        async function editStudent(regNo) {
            const response = await fetch(`/api/student/${regNo}`);
            if (response.ok) {
                const student = await response.json();
                // Populate the form fields with the fetched data
                document.getElementById('regNo').value = student.regNo;
                document.getElementById('name').value = student.name;
                document.getElementById('dob').value = student.dob;
                document.getElementById('gender').value = student.gender;
                document.getElementById('address').value = student.address;
                document.getElementById('phoneNo').value = student.phoneNo;
                document.getElementById('email').value = student.email;
                document.getElementById('guardianName').value = student.guardianName;
                document.getElementById('guardianPhone').value = student.guardianPhone;
                document.getElementById('doj').value = student.doj;
                document.getElementById('branch').value = student.branch;
            } else {
                alert('Failed to fetch student for editing');
            }
        }


        // Fetch all students initially
        fetchAllStudents();
    </script>
</body>

</html>
